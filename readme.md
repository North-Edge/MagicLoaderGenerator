# MagicLoader generator

## Description
This library is intended to facilitate the generation of translation files to be used by 
[MagicLoader](https://www.nexusmods.com/oblivionremastered/mods/1966) in order to mod Oblivion: Remastered.

Project and Solution templates are available by using `dotnet new` as follows:\
`dotnet new install NorthEdge.MagicLoaderGenerator.Templates` (first time only)\
`dotnet new mlg-sln -n MyMod` for a complete solution or
`dotnet new mlg-mod -n MyMod` for a console project only.

## Configuration

The configuration of an application using this library is broken down in several parts. 
See the [sample configuration file](config.example.json).

### Filesystem
These parameters control the output of the generator. See:\
[IModOutputGenerator](MagicLoaderGenerator/Filesystem/Abstractions/IModOutputGenerator.cs)\
[FolderOutputGenerator](MagicLoaderGenerator/Filesystem/Generators/FolderOutputGenerator.cs)\
[ZipOutputGenerator](MagicLoaderGenerator/Filesystem/Generators/ZipOutputGenerator.cs)\
[MagicLoaderMod](MagicLoaderGenerator/MagicLoaderMod.cs)

### `ModDirectoryStructure`
Default value: `OblivionRemastered\Content\Dev\ObvData\Data\MagicLoader\`

This parameter describes the directory structure generated by the mod.
>It is intended to reflect the directory structure of the game so that end-users of the mod can extract
the mod archive at the root directory of their game installation.

### `OutputDirectory`
Default value: `MagicLoader`

This parameter controls where the generator will output the mod file it produces.\
>It can be a relative path to the working directory of the executable or an absolute path.

### Localization
These parameters control the loading of the localization data.

### `LocalizationSource`
Default value: `Localization`

This parameter controls the source of the localization data.
> It can be a relative path to the working directory of the executable or an absolute path.\
The library only supports loading JSON files extracted using [FModel](https://github.com/4sval/FModel).
The expected structure is one folder per language (see [Languages](#languages) below) containing 
a file named `Game.json`.\
> **This translation data will not be provided.**

### `IncludedSections` 
Default value: `[ "ST_FullNames" ]`

This parameter controls which sections of the game localization data are loaded.
>Possible values are : 
`ST_FullNames` `ST_ResponseTexts` `ST_ScriptContent` `ST_BookContent` `ST_LogEntries`
`ST_HardcodedContent` `ST_AltarDynamicTexts` `ST_Descriptions` `ST_AltarStaticTexts` 
`ST_MissingEntries`\
See: [LocalizationFile](MagicLoaderGenerator/Localization/LocalizationFile.cs)
>
>[MagicLoader](https://www.nexusmods.com/oblivionremastered/mods/1966) can expand translation 
keys using the following syntax `$[[<translation key>]]` e.g. `$[[LOC_FN_Miscarcand01]]`.
However, please note that it might not expand keys other than FullNames (starting with `LOC_FN_`).
>
>This syntax will be used by the default transformer [TranslateFileTransform](MagicLoaderGenerator/Localization/Transforms/TranslateFileTransform.cs)
if a localization key is not found for a specific language.
For instance, `LOC_FN_SancreTor` has no translation in French or German.

#### `Languages`
Default value: `[ "de", "en", "es", "fr", "it", "ja", "pl", "pt", "ru", "zh-Hans" ]`

This parameter which languages are loaded by the localization provider which in turn changes
the files generated by the mod.
>They should have the matching directory in the Localization folder.
See [LanguagesEnum](MagicLoaderGenerator/Localization/LanguagesEnum.cs)

#### `Localizations`
Default value: `[]`

This parameter allows extra localization data to be added to the localization provider from the configuration.
> The keys are the localization keys and, they **must** start with `LOC_FN_`. The values are dictionaries with the
language codes as keys (see [Languages](#languages) above) and the translation as values. Example:
```
  "Localizations": {
    "LOC_FN_SoulLevelNameFilled": {
      "de": "Gefüllt",
      "en": "Filled",
      "es": "Completada",
      "fr": "Remplie",
      "it": "Riempito",
      "ja": "満たされた",
      "pl": "Wypełniony",
      "pt": "Cheia",
      "ru": "Заполненный",
      "zh-Hans": "充满"
    }
  }
```

### Mod
These parameters control the output of the generator by describing files and the localization keys to include.

### `ModName`
Default value: `MagicLoaderMod`

This parameter controls the root directory of the generator output as well as the name of 
the ZIP archives when using [ZipOutputGenerator](MagicLoaderGenerator/Filesystem/Generators/ZipOutputGenerator.cs).
> If [ModFiles](#modfiles) (see below) contains more than one entry, this value will
also be used to create a folder inside [ModDirectoryStructure](#moddirectorystructure).
 
### `ModFiles`
This parameter describes a dictionary of files to generate using a list of localization keys.
> The keys of the dictionary represent the name of the files generated by the mod.
The values contain dictionaries representing the sections handled by 
> [MagicLoader](https://www.nexusmods.com/oblivionremastered/mods/1966) as their keys
and a list of localization keys as their value.
The two supported sections are `FullNamesEditEntries` (`FullNames_Edit`) and `FullNameEntries`: (`FullNames`).\
See [MagicLoaderFile](MagicLoaderGenerator/Filesystem/MagicLoaderFile.cs)
